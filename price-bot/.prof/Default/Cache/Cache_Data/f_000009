!function(){"use strict";!function(){if(window.__is_sp_init)return void console.warn("$salespanel instance already exists. Using the existing instance.");var t=!0,e=0,i=3,n=[],a="https://api.salespanel.io",o=window.location.search.substring(1),r=!1,s=!1,c=!1,u={},d=[],l=[],p=!1;try{var f=JSON.parse('{"'+o.replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(t){f={}}var m="true"==f.spdebug,_=console.log,g=console.error;window.salespanelSettings=window.salespanelSettings||{},window.salespanelSettings=Object.assign({sp_automatic_lead_capture:!0,sp_track_form_bounces:!1,sp_lead_capture_on_submit:!1,sp_track_by_default:!0,sp_override_identity:!0,sp_visitor_attributes:{}},window.salespanelSettings);let v=!1;function h(){var t=document.getElementById("mytrackingscript");return t?t.getAttribute("data-client"):window.__sp}function y(){m&&_.apply(console,arguments)}function w(){m&&g.apply(console,arguments)}function b(t){try{var e=new URL(t);e.searchParams.get("sp_em")&&(e.searchParams.delete("sp_em"),window.history.replaceState(null,document.title,e))}catch(t){w("Error replacing url with email hash: ",t.message)}}window.navigator.userAgentData&&"mobile"in window.navigator.userAgentData?(y("sp: navigator.userAgentData found, skipping userAgent regex evaluation"),v=window.navigator.userAgentData.mobile):(y("sp: navigator.userAgentData not found, using userAgent regex evaluation"),v=function(t){try{const e=/(iPhone|iPod|iPad|iOS-universal(?:.+)Mac|Android(?:.+)Mobile|Android|Silk|SD4930UR|\bSilk(?:.+)Mobile\b|Windows Phone|Windows(?:.+)ARM|BlackBerry|BB10|Opera Mini|(CriOS|Chrome)(?:.+)Mobile|Mobile(?:.+)Firefox\b)/i;let i=t.split("[FBAN")[0].split("Twitter")[0];return e.test(i)}catch(t){return w("Error detecting mobile device:",t),!1}}(navigator.userAgent));var S=document.URL;function k(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function A(t,e){var i=t.getAttribute("id"),n=t.getAttribute("name"),a=t.getAttribute("class"),o=t.form;if(o)var r=o.getAttribute("id"),s=o.getAttribute("name"),c=o.getAttribute("class");var u={form_action:"filled_web_form",sp_input_id:i,sp_input_name:n,sp_input_class:a,sp_form_id:r,sp_form_name:s,sp_form_class:c};return e&&(u.sp_em=e),u}if(b(S),P(S),!v&&window.salespanelSettings.sp_automatic_lead_capture&&window.salespanelSettings.sp_track_form_bounces){var x=!1;document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("form").forEach((t=>{t.addEventListener("submit",(()=>{x=!0}))}))}))}function O(){if(p)y("Visitor is not being tracked");else{var t=a+"/apiv1/page-visit-beacon/?client_id="+h(),e={};e.sp_id=N("track_uid"),e.page_url=document.URL,!v&&window.salespanelSettings.sp_automatic_lead_capture&&window.salespanelSettings.sp_track_form_bounces&&function(){if(x)return y("sp: a form has already been submitted."),!1;const t=document.querySelectorAll("input, textarea");return Array.from(t).some((t=>{const e=["text","email"].includes(t.type)||"textarea"===t.tagName.toLowerCase(),i=""!==t.value.trim();return!(!e||!i||(u=A(t),0))}))}()&&(e.event="form_bounce",e.payload=u),navigator.sendBeacon(t,JSON.stringify(e))}}function T(t){try{document.cookie="cookietest=1"+(t?"; domain="+t:"");var e=-1!=document.cookie.indexOf("cookietest=");return document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT"+(t?"; domain="+t:""),e}catch(t){return!1}}function E(t,e,i){if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var a="; expires="+n.toGMTString()}else a="";var o=t+"="+e+a+";path=/;";(void 0===window.__sp_subdomains||window.__sp_subdomains)&&(o+="domain="+function(){for(var t=0,e=document.domain,i=e.split("."),n="_gd"+(new Date).getTime();t<i.length-1&&-1==document.cookie.indexOf(n+"="+n);)e=i.slice(-1-++t).join("."),document.cookie=n+"="+n+";domain="+e+";";return document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+e+";","localhost"!==e?"."+e:e}()+";"),document.cookie=o}function N(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return null}function P(t){if(T()&&(e=JSON.parse(N("sp_opt_in")),window.salespanelSettings.sp_track_by_default||e)){var e,i;if(null==(i=N("track_uid"))){var n=k();E("track_uid",n,365),i=n}j(t,i)}}function I(){if(window.salespanelSettings.sp_override_identity)return!1;var t=N("track_uid");return!!JSON.parse(localStorage.getItem("sp_identified")||"{}")[t]}function j(t,e){y(t);var i=h(),n=a+"/apiv1/track/",o=N("track_uid"),u=document.referrer,d=document.title,l=new URL(n);l.searchParams.set("title",d),l.searchParams.set("referrer",u),l.searchParams.set("sp_id",o),l.searchParams.set("client_id",i),l.searchParams.set("url",encodeURI(t)),!c&&window.salespanelSettings.sp_visitor_attributes&&Object.keys(window.salespanelSettings.sp_visitor_attributes).length&&(l.searchParams.set("visitor_attributes",JSON.stringify(window.salespanelSettings.sp_visitor_attributes)),c=!0),window.salespanelSettings.sp_override_identity&&l.searchParams.set("override_identity",!0),y(l);var f=new XMLHttpRequest;f.open("GET",l),f.send(null),f.onreadystatechange=function(){if(4===f.readyState){y("res",f.response);var t=JSON.parse(f.response);if(!0!==t.email&&!0!==t.override||e==t.sp_id||E("track_uid",t.sp_id||k(),365),!0===t.email){var i=JSON.parse(localStorage.getItem("sp_identified")||"{}");i[t.sp_id]=!0,localStorage.setItem("sp_identified",JSON.stringify(i))}t.visitor_qualification_api_active&&(s=t.visitor_qualification_api_active),t.do_not_track&&(p=t.do_not_track),t.has_active_segment_triggers&&G.trigger_custom_triggers(),r=!0}},window.salespanelSettings.sp_automatic_lead_capture&&(window.salespanelSettings.sp_lead_capture_on_submit?function(t){z(document);try{for(var e=document.getElementsByTagName("iframe"),i=0;i<e.length;i++){$(e[i])}J($)}catch(t){w("Error accessing iframe: no permission: ",t)}}():function(t){var e=[];B(document,e);for(var i=document.getElementsByTagName("iframe"),n=0;n<i.length;n++){U(i[n],e)}J(U)}())}function q(t,e){for(var i in e)e[i]&&(t=L(t,i,e[i]));return t}function L(t,e,i){if(!t)return t;var n=t.indexOf("#"),a=t.indexOf("?");return a>-1?n>=0&&n<a?t.substr(0,n)+"?"+e+"="+i+t.substr(n,t.length):t.substr(0,a+1)+e+"="+i+"&"+t.substr(a+1,t.length):n>-1?t.substr(0,n)+"?"+e+"="+i+t.substr(n,t.length):t+"?"+e+"="+i}v?document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&O()})):window.addEventListener("pagehide",(function(t){O()})),window.addEventListener("hashchange",(function(){b(S=document.URL),P(S)}));var M=/^[a-zA-Z0-9\.!#$%&*+=?^_~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;function R(t,e,i=[]){l[t]||(e(d[t],i),l[t]=!0)}function F(t){return!(!window.LeadBooster||!t.getElementById("pipedrive-chat-holder"))&&(y("LeadBooster allowed"),!0)}function J(t){new MutationObserver((function(e){e.forEach((function(e){[].filter.call(e.addedNodes,(function(t){try{return t.getElementsByTagName("iframe").length>0||"IFRAME"==t.nodeName}catch(t){return!1}})).forEach((function(e){if("IFRAME"==e.nodeName)d.indexOf(e)<0&&t(e);else for(var i=e.getElementsByTagName("iframe"),n=0;n<i.length;n++){var a=i[n];d.indexOf(a)<0&&t(a)}}))}))})).observe(document.body,{childList:!0,subtree:!0})}function B(t,e){var i=t.getElementsByTagName("input");if(y("inputs:",i),e.push(i),F(t)){var n=t.getElementsByTagName("textarea");y("textareas:",n),e.push(n)}t.addEventListener("click",(function(t){H(e)})),t.addEventListener("keydown",(function(t){"Tab"==t.key&&H(e)}))}function C(t,e){try{B(t.contentWindow.document,e)}catch(e){w("Error accessing iframe: no permission: ",e,t)}}function U(t,e=[]){try{if(t.contentDocument||t.contentWindow&&t.contentWindow.document){t.contentWindow.onload=function(){C(this.frameElement,e),l[d.indexOf(this.frameElement)]=!0},d.push(t);var i=l.push(!1);setTimeout((function(){R(i-1,C,e)}),1e3)}}catch(t){w("Error accessing iframe: no permission: ",t)}}function z(t){t.addEventListener("submit",(function(e){for(var i=[],n=[],a=e.target.getElementsByTagName("input"),o=0;o<a.length;o++)"INPUT"!==a[o].nodeName||"text"!==a[o].type&&"email"!==a[o].type||n.push(a[o]);if(i.push(n),F(t)){var r=e.target.getElementsByTagName("textarea");y("textareas:",r),i.push(r)}H(i)}))}function D(t){try{z(t.contentWindow.document)}catch(t){w("Error accessing iframe: no permission: ",t)}}function $(t){if(t.contentDocument||t.contentWindow.document){t.contentWindow.onload=function(){D(this.frameElement),l[d.indexOf(this.frameElement)]=!0},d.push(t);var e=l.push(!1);setTimeout((function(){R(e-1,D)}),1e3)}}function H(a){if(p)y("Visitor is not being tracked");else if(I())y("Visitor already identified");else{y("inputs_array",a,d,l),y("emails_tracked",n);for(var o=0;o<a.length;o++)for(var r=0;r<a[o].length;r++)if(void 0!==a[o][r]||null!=a[o][r]){var s=a[o][r].value||"",c=s&&!n.includes(s);if(M.test(s)&&(!0===window.salespanelSettings.sp_override_identity&&e<i&&c||!1===window.salespanelSettings.sp_override_identity&&t)){e++,t=!1,n.push(s),y("fireEmailCounter",e),y("oncePerPage",t);var u=A(a[o][r],s),f=q(document.URL,u);y("form",a[o][r].form),j(f);break}}}}function V(t){var e=document.createElement("div");document.body.append(e);var i=e;i.innerHTML=t,function(t){var i,n=["application/javascript","application/ecmascript","application/x-ecmascript","application/x-javascript","text/ecmascript","text/javascript","text/javascript1.0","text/javascript1.1","text/javascript1.2","text/javascript1.3","text/javascript1.4","text/javascript1.5","text/jscript","text/livescript","text/x-ecmascript","text/x-javascript"],a=t.querySelectorAll("script");[].forEach.call(a,(function(t){(i=t.getAttribute("type"))&&-1===n.indexOf(i)||function(t){var i=document.createElement("script");i.type="text/javascript",t.src?i.src=t.src:i.textContent=t.innerText||t.textContent;t.parentNode.removeChild(t),e.appendChild(i)}(t)}))}(i)}function W(t){if(r){var e=N("track_uid"),i={client_id:h(),event:t,additional_data:{page_url:S}};y("calendly data",t);var n=new XMLHttpRequest,o=a+"/apiv1/identify/calendly/"+e+"/";n.open("POST",o,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(i))}else setTimeout(W,100,t)}window.addEventListener("message",(function(t){try{(function(t){return t.data.event&&"calendly.event_scheduled"===t.data.event})(t)&&W(t.data)}catch(t){y("Calendly event error:",t)}}));var Z=window.$salespanel||[],G={};window.$SP_visitor_data=null;var X=!1,K=!0,Q=!1,Y=!1,tt=null,et=[],it=!1;G.Actions=new(function(){function t(){this.ns="spactions",this.availableActionItems=["actionitem"],this.actionsForActionItem={actionitem:["set","get"]}}function e(){this.ns="identify",this.availableActionItems=["email"],this.actionsForActionItem={email:["set"]}}function i(){this.ns="tags",this.availableActionItems=["add","remove"],this.actionsForActionItem={add:["set"],remove:["set"]}}function n(){this.ns="qualify",this.availableActionItems=["visitor"],this.actionsForActionItem={visitor:["get"]},this.timeout_time=700,this.call_scheduler=!1,this.tick_timeout_time=5e3}function o(){this.ns="activity",this.availableActionItems=["customActivity"],this.actionsForActionItem={customActivity:["set"]}}function c(){this.ns="tracking",this.availableActionItems=["allowTracking"],this.actionsForActionItem={allowTracking:["set"]}}function u(){this.ns="attributes",this.availableActionItems=["visitor"],this.actionsForActionItem={visitor:["set"]}}function d(){this.actionNamespace=["identify","qualify","activity","tags","tracking","attributes"],this.actionNamespaceMapping={identify:e,qualify:n,activity:o,tags:i,tracking:c,attributes:u}}return t.prototype.getString=function(t){return this.ns+t},t.prototype.get_action_item_from_args=function(t){try{var e=t.split(/:(.+)/),i=e[0],n=e[1];return i!==this.ns?(w("Invalid action",t),!1):n}catch(t){return w(t),!1}},t.prototype.perform_check=function(t,e){var i=this.get_action_item_from_args(t);return i?-1===this.availableActionItems.indexOf(i)?(w("ActionItem not found: ",t),!1):-1!==this.actionsForActionItem[i].indexOf(e)||(w("Action not found: ",e),!1):(w("ActionItem not found: ",t),!1)},t.prototype.get_action=function(t,e){if(this.perform_check(t,e))switch(e){case"get":case"set":return w("function definition needed"),!1;default:return w("action not recognized"),!1}},t.prototype.perform_action=function(t,e,i){(e=this.get_action(t,e))&&e(i)},t.prototype.make_xhr_call=function(t,e="GET",i=null){var n=new XMLHttpRequest;return new Promise((function(a,o){n.onreadystatechange=function(){if(4===n.readyState)if(n.status>=200&&n.status<300)a(n);else{if(n.response)var t=JSON.parse(n.response).detail;t||(t=n.statusText),o({status:n.status,statusText:t})}},n.open(e,t,!0),"GET"!==e&&n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(i)}))},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.get_action=function(t,e){if(this.perform_check(t,e))return"set"===e?function(t){var e=t[0],i=t[1]?t[1]:"sdk";I()?y("Visitor already identified"):M.test(e)?j(L(L(document.URL,"source",i),"sp_em",e)):w("Invalid Email",t[0])}:(w("action not recongnized"),!1)},i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.add_or_remove_tags=function(t,e,i){var n=N("track_uid"),o=h(),r=a+"/apiv1/tags/"+n+"/person/"+t+"/?client_id="+o;i.make_xhr_call(r,"POST",JSON.stringify(e)).then((function(i){y('Successful "'+t+'" tag operation:',e,i)})).catch((function(t){y("Something went wrong",t)}))},i.prototype.add_tags=function(t,e){return this.add_or_remove_tags("add",t,e)},i.prototype.remove_tags=function(t,e){return this.add_or_remove_tags("remove",t,e)},i.prototype.process_tags=function(t){if(Array.isArray(t[0])){if(0===t[0].length)return{};var e={};return e.tags=t[0],e}return w("Array of tags required."),{}},i.prototype.get_action=function(t,e){var i=this;if(this.perform_check(t,e)){var n=this.get_action_item_from_args(t);if("set"===e){if("add"==n)return function(t){var e=i.process_tags(t);if(0!==Object.keys(e).length)return i.add_tags(e,i)};if("remove"==n)return function(t){var e=i.process_tags(t);if(0!==Object.keys(e).length)return i.remove_tags(e,i)}}return w("action not recongnized"),!1}},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.qualify_contact=function(t,e,i,n=!1){if(r&&!s&&!n)return e("Salespanel Visitor qualification API plugin is not activated. Please upgrade or contact Salespanel support.");if(r)if(X)if(Q)Y?t(window.$SP_visitor_data):e(tt);else if(i.call_scheduler&&X&&K){K=!1;var o=N("track_uid"),c=new URL(a+"/apiv1/qualify/visitor/"+o+"/");c.searchParams.set("client_id",h()),c.searchParams.set("segments",JSON.stringify(et)),i.make_xhr_call(c).then((function(n){y("Success!",n);var r=JSON.parse(n.response);window.$SP_visitor_data=r.data,Q=!0,K=!1,Y=!0;for(var s=[],c=0;c<r.custom_html.length;c++)V(r.custom_html[c].html),s.push(r.custom_html[c].uid);if(et=s,s.length>0){var u=a+"/apiv1/qualify/visitor/"+o+"/log/",d={client_id:h(),triggers:s};i.make_xhr_call(u,"POST",JSON.stringify(d))}it||(it=!0,setTimeout((function(){X=!0,i.call_scheduler=!0,K=!0,Q=!1,i.qualify_contact(t,e,i,!0)}),i.tick_timeout_time)),t(window.$SP_visitor_data)})).catch((function(t){y("Something went wrong",t),K=!1,Q=!0,Y=!1,tt=t,e(t)}))}else setTimeout(i.qualify_contact,100,t,e,i,n);else{X=!0,i.call_scheduler=!0;var u=f.sp_timeout?f.sp_timeout:i.timeout_time;setTimeout(i.qualify_contact,u,t,e,i,n)}else setTimeout(i.qualify_contact,100,t,e,i,n)},n.prototype.trigger_custom_triggers=function(){var t=this;new Promise((function(e,i){return t.qualify_contact(e,i,t,!0)}))},n.prototype.get_action=function(t,e){var i=this;if(this.perform_check(t,e)){var n=this.get_action_item_from_args(t);return new Promise("get"===e&&"visitor"==n?function(t,e){return i.qualify_contact(t,e,i)}:function(t,e){e("action not recognized")})}},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.log_activity=function(t,e){var i=N("track_uid"),n=h(),o=a+"/apiv1/custom-activity/"+n+"/"+i+"/";t.make_xhr_call(o,"POST",JSON.stringify(e)).then((function(t){y("Success logging custom activity:",e,t)})).catch((function(t){console.error("Something went wrong",t)}))},o.prototype.get_action=function(t,e){var i=this;if(this.perform_check(t,e)){var n=this.get_action_item_from_args(t);return"set"===e&&"customActivity"==n?function(t){if(t.length<2||"string"!=typeof t[0]||"string"!=typeof t[1])return w("'category' and 'label' both are required fields"),!1;var e={};return e.category=t[0],e.label=t[1],"string"==typeof t[2]?(e.identifier=t[2],e.metadata=t[3]):e.metadata=t[2],e&&e.category&&e.label?i.log_activity(i,e):void 0}:(w("action not recongnized"),!1)}},c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.prototype.get_action=function(t,e){if(this.perform_check(t,e)){var i=this.get_action_item_from_args(t);return"set"===e&&"allowTracking"==i?function(t){E("sp_opt_in",1,365),r||P(S)}:(w("action not recongnized"),!1)}},u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype.set_visitor_attributes=function(t,e){var i=N("track_uid"),n=h(),o=a+"/apiv1/set-visitor-attributes/"+n+"/"+i+"/";t.make_xhr_call(o,"POST",JSON.stringify(e)).then((function(t){y("Success updating data:",e,t)})).catch((function(t){y("Something went wrong",t)}))},u.prototype.get_action=function(t,e){var i=this;if(this.perform_check(t,e)){var n=this.get_action_item_from_args(t);return"set"===e&&"visitor"==n?function(t){var e=t[0];if(e&&e.constructor===Object&&Object.keys(e).length>0)return i.set_visitor_attributes(i,e)}:(w("action not recongnized"),!1)}},d.prototype.getAction=function(t){try{var e=t.split(/:(.+)/)[0];return-1===this.actionNamespace.indexOf(e)?(w("Invalid action",t),!1):new this.actionNamespaceMapping[e]}catch(t){return w(t),!1}},d}()),G.Execute=new(function(){function t(){}return t.prototype.perform_target_action=function(t,e){var i=t[0],n=t[1];if(!r&&n.indexOf("allowTracking")<0)setTimeout(e.perform_target_action,100,t,e);else{if(p)return void y("Visitor is not being tracked");var a=G.Actions.getAction(n),o=t.slice(2);if(a){var s=a.get_action(n,i);if("get"==i){var c=!1;if(o.length>0)var u=o[0];if("function"==typeof u&&(c=!0),!s||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then){if(s){if(data=s(o),!c)return data;u(data)}}else{if(!c)throw"Callback function is required.";s.then((function(t){u(t)})).catch((function(t){w("Something went wrong",t)}))}}else"set"==i&&s&&s(o)}}},t.prototype.push=function(t){return this.perform_target_action(t,this)},t}()),G.trigger_custom_triggers=function(){this.Actions.getAction("qualify").trigger_custom_triggers()};var nt={push:function(t){if(T())return G.Execute.push(t)}};for(window.$salespanel=nt,window.__is_sp_init=!0;Z.length>0;)window.$salespanel.push(Z.shift());window.addEventListener("message",(function(t){if(t.data&&t.data.type&&"hsFormCallback"===t.data.type){if("onFormSubmitted"===t.data.eventName&&t.data.data&&t.data.data.submissionValues){var e=t.data.data.submissionValues.email;e?(y("Identified from hsFormCallback"),window.$salespanel.push(["set","identify:email",e,"hubspot"])):y("Email not found in the submission values.")}else t.data.eventName||y("Event name is missing."),t.data.data&&t.data.data.submissionValues||y("Submission values are missing or malformed.");const r=["onFormReady","onFormSubmitted"];if(t.data.eventName&&r.includes(t.data.eventName)){var i=new XMLHttpRequest,n=a+"/apiv1/tracking-log/",o={client_id:h(),contact_id:N("track_uid"),log_data:t.data};i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(o))}}else y("Received a message event not related to Hubspot forms.")}))}()}();
